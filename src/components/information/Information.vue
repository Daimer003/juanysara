<template>
  <div class="flex justify-center bg-texture">
    <div class="w-full max-w-[800px] text-center p-4">
      <!-- Nombres + flor -->
      <div class="flex flex-col items-center">
        <img src="/assets/flores-3.png" alt="Decoraci√≥n flores" class="w-30 h-auto " />

        <div class="flex items-end space-x-6">
          <div class="text-center">
            <h1 class="font-script text-7xl md:text-8xl text-gray-800">Juan</h1>
            <p class="font-serif text-lg text-gray-700">Guzm√°n</p>
          </div>

          <p class="font-script text-3xl md:text-4xl text-gray-800 mb-3">&</p>

          <div class="text-center">
            <h1 class="font-script text-7xl md:text-8xl text-gray-800">Sara</h1>
            <p class="font-serif text-lg text-gray-700">Franco</p>
          </div>
        </div>
      </div>

      <p class="mt-4 font-serif text-base text-gray-700 mt-10">
        Tenemos el honor de invitarlos a celebrar nuestra uni√≥n matrimonial
      </p>

      <p class="mt-2 font-serif text-[#793710]">
        <span class="font-script text-4xl">
          {{ companion }}
        </span> ‚Äî N√∫mero de invitados: {{ invitados }}
      </p>

      <!-- Fecha con l√≠neas -->
      <div class="mt-8">
        <div class="flex items-center justify-between text-gray-700">
          <div class="flex-1 border-t border-[#efc289]"></div>
          <span class="px-3 font-serif">Mi√©rcoles</span>
          <div class="flex-1 border-t border-[#efc289]"></div>
        </div>

        <p class="mt-2 font-serif text-gray-700">Noviembre</p>
        <h2 class="text-7xl font-serif font-bold text-[#793710]">19</h2>
        <p class="font-serif text-gray-700">2025</p>

        <div class="flex items-center justify-between mt-2 text-gray-700">
          <div class="flex-1 border-t border-[#efc289]"></div>
          <span class="px-3 font-serif">4:00pm</span>
          <div class="flex-1 border-t border-[#efc289]"></div>
        </div>
      </div>

      <div class="border-t border-[#efc289] my-8"></div>

      <!-- Ceremonia y Recepci√≥n -->
      <div class="grid grid-cols-2 gap-0 relative">
        <div class="absolute top-0 bottom-0 left-1/2 border-l border-[#efc289]"></div>

        <div class="pr-6">
          <h3 class="font-serif font-semibold">Ceremonia</h3>
          <p class="text-xs font-serif md:text-sm">4:00pm</p>
          <p class="text-xs font-serif md:text-sm">Forest Campestre</p>
          <p class="text-xs font-serif md:text-sm">Envigado</p>
        </div>

        <div class="pl-6">
          <h3 class="font-serif font-semibold">Recepci√≥n</h3>
          <p class="text-xs font-serif md:text-sm">Despu√©s de la ceremonia</p>
          <p class="text-xs font-serif md:text-sm">Forest Campestre</p>
          <p class="text-xs font-serif md:text-sm">Envigado</p>
        </div>
      </div>

      <div class="border-t border-[#efc289] my-8"></div>

      <!-- Dress Code -->
      <div class="text-gray-700">
        <h3 class="font-serif font-semibold">Colores reservados</h3>
        <p class="mt-2 font-serif text-sm">Estos colores est√°n destinados exclusivamente a los novios</p>

        <div class="flex justify-center space-x-8 mt-4">
          <div class="flex flex-col items-center">
            <div class="w-12 h-12 rounded-full border-2 border-gray-400" style="background: black;"></div>
            <p class="mt-1 text-xs font-serif text-gray-700">Juan Guzm√°n ‚Äî Negro</p>
          </div>
          <div class="flex flex-col items-center">
            <div class="w-12 h-12 rounded-full border-2 border-gray-400" style="background: white;"></div>
            <p class="mt-1 text-xs font-serif text-gray-700">Sara Franco ‚Äî Blanco</p>
          </div>
        </div>
      </div>

      <div class="border-t border-[#efc289] my-8"></div>

      <!-- Colores invitados -->
      <div class="text-gray-700">
        <h3 class="font-serif font-semibold">¬øSin ideas?</h3>
        <p class="mt-2 font-serif">Aqu√≠ tienes un par de outfits que pueden inspirarte y hacer que brilles en este d√≠a tan especial.</p>
      </div>

      <!-- Vestimenta interactiva -->
      <div ref="vestimentaSection" class="mt-6 grid grid-cols-2 gap-3 items-start">
        <!-- HOMBRES -->
        <div class="flex flex-col items-center">
          <div class="relative w-full max-w-[320px]">
            <img :src="manImages[selectedMan]" alt="Smoking hombre"
              class="w-full h-auto shadow-md object-cover" />
          </div>
          <p class="mt-3 font-serif text-sm text-gray-700">Hombres ‚Äî elija color</p>

          <div class="flex flex-wrap justify-center gap-3 mt-3">
            <button
              v-for="(color, key) in manColors"
              :key="key"
              @click="selectedMan = key"
              :aria-pressed="selectedMan === key"
              class="w-10 h-10 rounded-full border-2 flex items-center justify-center focus:outline-none transition"
              :class="selectedMan === key ? 'ring-2 ring-[#efc289] border-[#efc289]' : 'border-gray-300'"
              :title="color.name"
              :style="{ background: color.hex }">
            </button>
          </div>
        </div>

        <!-- MUJERES -->
        <div class="flex flex-col items-center">
          <div class="relative w-full max-w-[320px]">
            <img :src="womanImages[selectedWoman]" alt="Vestido mujer"
              class="w-full h-auto shadow-md object-cover" />
          </div>
          <p class="mt-3 font-serif text-sm text-gray-700">Mujeres ‚Äî elija color</p>

          <div class="flex flex-wrap justify-center gap-3 mt-3">
            <button
              v-for="(color, key) in womanColors"
              :key="key"
              @click="selectedWoman = key"
              :aria-pressed="selectedWoman === key"
              class="w-10 h-10 rounded-full border-2 flex items-center justify-center focus:outline-none transition"
              :class="selectedWoman === key ? 'ring-2 ring-[#efc289] border-[#efc289]' : 'border-gray-300'"
              :title="color.name"
              :style="{ background: color.hex }">
            </button>
          </div>
        </div>
      </div>

      <!-- Audio de vestimenta -->
      <audio ref="vestimentaAudio" :src="vestimentaSong" preload="auto"></audio>

      <div class="border-t border-[#efc289] my-8"></div>

      <!-- Confirmaci√≥n -->
      <div class="flex items-center justify-between text-gray-700">
        <div class="flex-1 border-t border-[#efc289]"></div>
        <span class="px-3 font-serif">Confirma tu asistencia</span>
        <div class="flex-1 border-t border-[#efc289]"></div>
      </div>

      <div class="flex justify-center mt-4">
        <button @click="confirmarAsistencia"
          class="px-6 w-full h-[50px] py-2 bg-[#793710] text-white font-small font-serif shadow-md hover:bg-[#793720] transition-colors">
          Confirmar
        </button>
      </div>

      <div class="border-t border-[#efc289] my-8"></div>

      <p class="mt-2 font-serif text-gray-700">
        Nuestra felicidad solo est√° completa cuando la compartimos con las personas a las que amamos
      </p>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onBeforeUnmount } from "vue";
import { useRoute } from "vue-router";

const route = useRoute();

// Capitalizar palabras
function capitalizeWords(str) {
  return str
    .toLowerCase()
    .split(" ")
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");
}

const rawCompanion = route.query.companion || "Invitado";
const companion = capitalizeWords(rawCompanion.replace(/-/g, " "));
const invitados = route.query.invitados || 1;

// Hombre colores + im√°genes
const selectedMan = ref("terracota");
const manColors = {
  terracota: { name: "Terracota", hex: "#b35832" },
  azul: { name: "Azul Marino", hex: "#1a2a44" },
  oxido: { name: "√ìxido", hex: "#a0522d" },
  oliva: { name: "Verde Oliva", hex: "#556b2f" },
  gris: { name: "Gris", hex: "#9e9e9e" },
  matcha: { name: "Matcha", hex: "#6b8e23" }
};
const manImages = {
  terracota: "https://res.cloudinary.com/diccp2984/image/upload/v1758736374/Mask_group_tbepox.jpg",
  azul: "https://res.cloudinary.com/diccp2984/image/upload/v1758736374/Mask_group_1_gioydf.jpg",
  oxido: "https://res.cloudinary.com/diccp2984/image/upload/v1758736373/Mask_group_2_w4altc.jpg",
  oliva: "https://res.cloudinary.com/diccp2984/image/upload/v1758736373/Mask_group_3_vsrrnv.jpg",
  gris: "https://res.cloudinary.com/diccp2984/image/upload/v1758736373/Mask_group_4_lci2so.jpg",
  matcha: "https://res.cloudinary.com/diccp2984/image/upload/v1758736373/Mask_group_5_bsalqx.jpg"
};

// Mujer colores + im√°genes
const selectedWoman = ref("terracota");
const womanColors = {
  terracota: { name: "Terracota", hex: "#b35832" },
  matcha: { name: "Matcha", hex: "#809671" },
  pistacho: { name: "Pistacho", hex: "#B3B792" },
  azul: { name: "Azul Suave", hex: "#87a6c0" },
  beige: { name: "Beige Vainilla", hex: "#E8D9B5" },
  rosa: { name: "Rosa Empolvado", hex: "#D8AFA8" }
};
const womanImages = {
  terracota: "https://res.cloudinary.com/diccp2984/image/upload/v1758736374/Mask_group_10_crpzme.jpg",
  matcha: "https://res.cloudinary.com/diccp2984/image/upload/v1758736374/Mask_group_7_qvjivh.jpg",
  pistacho: "https://res.cloudinary.com/diccp2984/image/upload/v1758736374/Mask_group_8_yg01hj.jpg",
  azul: "https://res.cloudinary.com/diccp2984/image/upload/v1758736373/Mask_group_9_qonegx.jpg",
  beige: "https://res.cloudinary.com/diccp2984/image/upload/v1758745536/Mask_group_11_hmfu7e.jpg",
  rosa: "https://res.cloudinary.com/diccp2984/image/upload/v1758745536/Mask_group_12_msvtle.jpg"
};

// M√∫sica vestimenta
const vestimentaSection = ref(null);
const vestimentaAudio = ref(null);
const vestimentaSong = "https://tuservidor.com/cancion.mp3"; // üé∂ URL canci√≥n

// Guardar y controlar audios
const allAudios = [];

onMounted(() => {
  allAudios.push(...document.querySelectorAll("audio"));

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          allAudios.forEach((a) => {
            if (a !== vestimentaAudio.value) a.pause();
          });
          vestimentaAudio.value.play().catch(() => {
            console.log("El navegador bloque√≥ la reproducci√≥n autom√°tica");
          });
        } else {
          vestimentaAudio.value.pause();
        }
      });
    },
    { threshold: 0.5 }
  );

  if (vestimentaSection.value) observer.observe(vestimentaSection.value);

  onBeforeUnmount(() => {
    if (vestimentaSection.value) observer.unobserve(vestimentaSection.value);
  });
});

// WhatsApp confirmaci√≥n
const telefono = "573125660618";
function confirmarAsistencia() {
  const mensaje = `Confirmaci√≥n de asistencia:\n\nInvitado principal: ${companion}\nN√∫mero de invitados: ${invitados}`;
  const url = `https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`;
  window.location.href = url;
}
</script>

<style scoped>
@import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;600&display=swap');

.font-script {
  font-family: 'Great Vibes', cursive;
}

.font-serif {
  font-family: 'Playfair Display', serif;
}
</style>